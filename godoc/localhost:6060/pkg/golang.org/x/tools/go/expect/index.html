<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>expect - The Go Programming Language</title>

<link type="text/css" rel="stylesheet" href="../../../../../../lib/godoc/style.css">


<script>window.initFuncs = [];</script>

<script src="../../../../../../lib/godoc/jquery.js" defer></script>



<script>var goVersion = "go1.11.5";</script>
<script src="../../../../../../lib/godoc/godocs.js" defer></script>
</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="http://localhost:6060/">The Go Programming Language</a></div>
<div class="top-heading" id="heading-narrow"><a href="http://localhost:6060/">Go</a></div>
<a href="index.html#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>
<form method="GET" action="http://localhost:6060/search">
<div id="menu">
<a href="http://localhost:6060/doc/">Documents</a>
<a href="../../../../../index.html">Packages</a>
<a href="http://localhost:6060/project/">The Project</a>
<a href="http://localhost:6060/help/">Help</a>

<a href="http://localhost:6060/blog/">Blog</a>


<span class="search-box"><input type="search" id="search" name="q" placeholder="Search" aria-label="Search" required><button type="submit"><span><!-- magnifying glass: --><svg width="24" height="24" viewBox="0 0 24 24"><title>submit search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg></span></button></span>
</div>
</form>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package expect
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "golang.org/x/tools/go/expect"</code></dd>
			</dl>
			<dl>
			<dd><a href="index.html#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="index.html#pkg-index" class="indexLink">Index</a></dd>
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>
Package expect provides support for interpreting structured comments in Go
source code as test expectations.
</p>
<p>
This is primarily intended for writing tests of things that process Go source
files, although it does not directly depend on the testing package.
</p>
<p>
Collect notes with the Extract or Parse functions, and use the
MatchBefore function to find matches within the lines the comments were on.
</p>
<p>
The interpretation of the notes depends on the application.
For example, the test suite for a static checking tool might
use a @diag note to indicate an expected diagnostic:
</p>
<pre>fmt.Printf(&#34;%s&#34;, 1) //@ diag(&#34;%s wants a string, got int&#34;)
</pre>
<p>
By contrast, the test suite for a source code navigation tool
might use notes to indicate the positions of features of
interest, the actions to be performed by the test,
and their expected outcomes:
</p>
<pre>var x = 1 //@ x_decl
...
print(x) //@ definition(&#34;x&#34;, x_decl)
print(x) //@ typeof(&#34;x&#34;, &#34;int&#34;)
</pre>
<h3 id="hdr-Note_comment_syntax">Note comment syntax</h3>
<p>
Note comments always start with the special marker @, which must be the
very first character after the comment opening pair, so //@ or /*@ with no
spaces.
</p>
<p>
This is followed by a comma separated list of notes.
</p>
<p>
A note always starts with an identifier, which is optionally followed by an
argument list. The argument list is surrounded with parentheses and contains a
comma-separated list of arguments.
The empty parameter list and the missing parameter list are distinguishable if
needed; they result in a nil or an empty list in the Args parameter respectively.
</p>
<p>
Arguments are either identifiers or literals.
The literals supported are the basic value literals, of string, float, integer
true, false or nil. All the literals match the standard go conventions, with
all bases of integers, and both quote and backtick strings.
There is one extra literal type, which is a string literal preceded by the
identifier &#34;re&#34; which is compiled to a regular expression.
</p>

				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
			
			
				
				<dd><a href="index.html#MatchBefore">func MatchBefore(fset *token.FileSet, readFile ReadFile, end token.Pos, pattern interface{}) (token.Pos, token.Pos, error)</a></dd>
			
			
				
				<dd><a href="index.html#Identifier">type Identifier</a></dd>
				
				
			
				
				<dd><a href="index.html#Note">type Note</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#Extract">func Extract(fset *token.FileSet, file *ast.File) ([]*Note, error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#Parse">func Parse(fset *token.FileSet, filename string, content []byte) ([]*Note, error)</a></dd>
				
				
			
				
				<dd><a href="index.html#ReadFile">type ReadFile</a></dd>
				
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="http://localhost:6060/src/golang.org/x/tools/go/expect/expect.go">expect.go</a>
			
				<a href="http://localhost:6060/src/golang.org/x/tools/go/expect/extract.go">extract.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
		
		
			
			
			<h2 id="MatchBefore">func <a href="http://localhost:6060/src/golang.org/x/tools/go/expect/expect.go?s=3313:3435#L75">MatchBefore</a>
				<a class="permalink" href="index.html#MatchBefore">&#xb6;</a>
				
				
			</h2>
			<pre>func MatchBefore(fset *<a href="http://localhost:6060/pkg/go/token/">token</a>.<a href="http://localhost:6060/pkg/go/token/#FileSet">FileSet</a>, readFile <a href="index.html#ReadFile">ReadFile</a>, end <a href="http://localhost:6060/pkg/go/token/">token</a>.<a href="http://localhost:6060/pkg/go/token/#Pos">Pos</a>, pattern interface{}) (<a href="http://localhost:6060/pkg/go/token/">token</a>.<a href="http://localhost:6060/pkg/go/token/#Pos">Pos</a>, <a href="http://localhost:6060/pkg/go/token/">token</a>.<a href="http://localhost:6060/pkg/go/token/#Pos">Pos</a>, <a href="http://localhost:6060/pkg/builtin/#error">error</a>)</pre>
			<p>
MatchBefore attempts to match a pattern in the line before the supplied pos.
It uses the FileSet and the ReadFile to work out the contents of the line
that end is part of, and then matches the pattern against the content of the
start of that line up to the supplied position.
The pattern may be either a simple string, []byte or a *regexp.Regexp.
MatchBefore returns the range of the line that matched the pattern, and
invalid positions if there was no match, or an error if the line could not be
found.
</p>

			
			

		
		
			
			
			<h2 id="Identifier">type <a href="http://localhost:6060/src/golang.org/x/tools/go/expect/extract.go?s=379:401#L13">Identifier</a>
				<a class="permalink" href="index.html#Identifier">&#xb6;</a>
				
				
			</h2>
			<p>
Identifier is the type for an identifier in an Note argument list.
</p>

			<pre>type Identifier <a href="http://localhost:6060/pkg/builtin/#string">string</a></pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="Note">type <a href="http://localhost:6060/src/golang.org/x/tools/go/expect/expect.go?s=2310:2510#L55">Note</a>
				<a class="permalink" href="index.html#Note">&#xb6;</a>
				
				
			</h2>
			<p>
Note is a parsed note from an expect comment.
It knows the position of the start of the comment, and the name and
arguments that make up the note.
</p>

			<pre>type Note struct {
<span id="Note.Pos"></span>    Pos  <a href="http://localhost:6060/pkg/go/token/">token</a>.<a href="http://localhost:6060/pkg/go/token/#Pos">Pos</a>     <span class="comment">// The position at which the note identifier appears</span>
<span id="Note.Name"></span>    Name <a href="http://localhost:6060/pkg/builtin/#string">string</a>        <span class="comment">// the name associated with the note</span>
<span id="Note.Args"></span>    Args []interface{} <span class="comment">// the arguments for the note</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="Extract">func <a href="http://localhost:6060/src/golang.org/x/tools/go/expect/extract.go?s=1530:1596#L43">Extract</a>
					<a class="permalink" href="index.html#Extract">&#xb6;</a>
					
					
				</h3>
				<pre>func Extract(fset *<a href="http://localhost:6060/pkg/go/token/">token</a>.<a href="http://localhost:6060/pkg/go/token/#FileSet">FileSet</a>, file *<a href="http://localhost:6060/pkg/go/ast/">ast</a>.<a href="http://localhost:6060/pkg/go/ast/#File">File</a>) ([]*<a href="index.html#Note">Note</a>, <a href="http://localhost:6060/pkg/builtin/#error">error</a>)</pre>
				<p>
Extract collects all the notes present in an AST.
Each comment whose text starts with @ is parsed as a comma-separated
sequence of notes.
See the package documentation for details about the syntax of those
notes.
</p>

				
				
			
				
				<h3 id="Parse">func <a href="http://localhost:6060/src/golang.org/x/tools/go/expect/extract.go?s=786:867#L22">Parse</a>
					<a class="permalink" href="index.html#Parse">&#xb6;</a>
					
					
				</h3>
				<pre>func Parse(fset *<a href="http://localhost:6060/pkg/go/token/">token</a>.<a href="http://localhost:6060/pkg/go/token/#FileSet">FileSet</a>, filename <a href="http://localhost:6060/pkg/builtin/#string">string</a>, content []<a href="http://localhost:6060/pkg/builtin/#byte">byte</a>) ([]*<a href="index.html#Note">Note</a>, <a href="http://localhost:6060/pkg/builtin/#error">error</a>)</pre>
				<p>
Parse collects all the notes present in a file.
If content is nil, the filename specified is read and parsed, otherwise the
content is used and the filename is used for positions and error messages.
Each comment whose text starts with @ is parsed as a comma-separated
sequence of notes.
See the package documentation for details about the syntax of those
notes.
</p>

				
				
			

			
		
			
			
			<h2 id="ReadFile">type <a href="http://localhost:6060/src/golang.org/x/tools/go/expect/expect.go?s=2732:2783#L65">ReadFile</a>
				<a class="permalink" href="index.html#ReadFile">&#xb6;</a>
				
				
			</h2>
			<p>
ReadFile  is the type of a function that can provide file contents for a
given filename.
This is used in MatchBefore to look up the content of the file in order to
find the line to match the pattern against.
</p>

			<pre>type ReadFile func(filename <a href="http://localhost:6060/pkg/builtin/#string">string</a>) ([]<a href="http://localhost:6060/pkg/builtin/#byte">byte</a>, <a href="http://localhost:6060/pkg/builtin/#error">error</a>)</pre>

			

			

			
			
			

			

			
		
	

	







<div id="footer">
Build version go1.11.5.<br>
Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
the content of this page is licensed under the
Creative Commons Attribution 3.0 License,
and code is licensed under a <a href="http://localhost:6060/LICENSE">BSD license</a>.<br>
<a href="http://localhost:6060/doc/tos.html">Terms of Service</a> |
<a href="http://www.google.com/intl/en/policies/privacy/">Privacy Policy</a>
</div>

</div><!-- .container -->
</div><!-- #page -->

</body>
</html>

